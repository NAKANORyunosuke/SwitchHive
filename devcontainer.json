{
  "name": "azure-funcs-py312",
  "image": "mcr.microsoft.com/devcontainers/python:1-3.12-bullseye",

  // VS Code 拡張（必要最低限）
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-azuretools.vscode-azurefunctions",
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-toolsai.jupyter",
        "ms-vscode.azurecli"
      ],
      "settings": {
        // .venv を使う想定
        "python.defaultInterpreterPath": "/workspaces/${containerWorkspaceFolderBasename}/.venv/bin/python",
        "azureFunctions.showProjectWarning": false
      }
    }
  },

  // 便利系 Features（Node は Core Tools/Azurite を npm で入れるため）
  "features": {
    "ghcr.io/devcontainers/features/node:1": {
      "version": "lts"
    },
    "ghcr.io/devcontainers/features/azure-cli:1": {},
    "ghcr.io/devcontainers/features/git:1": {}
  },

  "remoteUser": "vscode",
  "updateRemoteUserUID": true,

  // ローカル開発で使うポート
  "forwardPorts": [7071, 10000, 10001, 10002],
  "portsAttributes": {
    "7071": { "label": "Azure Functions" },
    "10000": { "label": "Azurite Blob" },
    "10001": { "label": "Azurite Queue" },
    "10002": { "label": "Azurite Table" }
  },

  "runArgs": ["--init"],

  // 依存の導入（Core Tools v4 & Azurite を npm で、Python 仮想環境を .venv に）
  "postCreateCommand": "bash .devcontainer/setup.sh",

  // 推奨：workspace ルートに requirements.txt / uv.lock / poetry.lock があれば自動インストール
  "postAttachCommand": "bash .devcontainer/after_attach.sh"
}
